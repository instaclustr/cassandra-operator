#!/usr/bin/env bash

set -o errexit
set -o nounset
set -o pipefail

cd `dirname "$BASH_SOURCE"`/..

function defer {
	if [[ $REPO == gcr.io/* ]]; then
		docker logout gcr.io
		export DONT_LOGIN="false"
	fi
}

trap defer EXIT

# We source this a bunch of times just to make stuff work. TODO: this needs a clean up
REPO="${REPO:-gcr.io/cassandra-operator}"


if [[ $REPO == gcr.io/* ]]; then
	gcloud docker -a
fi

export DONT_LOGIN="true"

./buildenv/release base-openjre
./buildenv/release-cassandra cassandra
./buildenv/release cassandra-sidecar
./buildenv/release cassandra-operator
